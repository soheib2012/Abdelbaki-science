<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¯Ø±ÙˆØ³ Ø®ØµÙˆØµÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ù‚ÙŠ</title>
  <style>
    :root{
      --pri:#2e7d32; --pri-2:#43a047; --bg:#f5f7fa; --card:#ffffff; --muted:#6b7280;
      --danger:#d32f2f; --warn:#ef6c00; --ok:#1b5e20;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:#111;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial}
    header{background:linear-gradient(135deg,var(--pri),var(--pri-2));color:#fff;padding:20px 16px;text-align:center;position:sticky;top:0;z-index:50}
    header .title{font-size:20px;margin:8px 0 0}
    .logo{width:96px;height:96px;object-fit:contain;background:#ffffff22;border-radius:16px;padding:8px;display:inline-block}
    .wrap{max-width:960px;margin:18px auto;padding:0 12px}
    .grid{display:grid;gap:12px}
    @media (min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}

    .card{background:var(--card);border-radius:14px;box-shadow:0 6px 24px #0000000f; padding:14px}
    h3{margin:6px 0 12px}
    .muted{color:var(--muted);font-size:14px}
    label{font-size:14px;color:#111;margin-top:6px;display:block}
    input,select{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin-top:6px;background:#fff}
    .btn{border:0;border-radius:10px;padding:10px 14px;background:var(--pri);color:#fff;cursor:pointer}
    .btn.secondary{background:#0ea5e9}
    .btn.flat{background:#e5e7eb;color:#111}
    .btn.warn{background:var(--warn)}
    .btn.danger{background:var(--danger)}
    .btn.ok{background:var(--ok)}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    table{width:100%;border-collapse:collapse;margin-top:10px;border:1px solid #e5e7eb}
    th,td{border-top:1px solid #e5e7eb;padding:10px;text-align:center}
    th{background:#f3f4f6}
    .pill{padding:4px 8px;border-radius:999px;background:#eef2ff;color:#1e40af;font-size:12px;display:inline-block}
    .hide{display:none}

    .tabs{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
    .tab{padding:8px 12px;border-radius:999px;background:#e5e7eb;cursor:pointer}
    .tab.active{background:var(--pri);color:#fff}
    .search{display:flex;gap:8px}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .kpi .card{padding:12px;text-align:center}
    .kpi h4{margin:0;font-size:14px;color:var(--muted)}
    .kpi .num{font-size:22px;margin-top:6px}
    .note{background:#fff8e1;color:#8d6e63;border:1px dashed #ffecb3;border-radius:10px;padding:10px;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <img class="logo" src="logo.png" alt="Ø´Ø¹Ø§Ø±"/>
    <div class="title">ğŸ“š Ø¯Ø±ÙˆØ³ Ø®ØµÙˆØµÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø³ØªØ§Ø°Ø© Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙÙŠ Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©</div>
    <div class="muted">ÙˆØ§Ø¬Ù‡Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø¬ÙˆØ§Ù„ â€“ Ø¥ØµØ¯Ø§Ø± Ù…Ø­Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù… (ÙŠØ¹Ù…Ù„ Ø¨â€ localStorage)</div>
  </header>

  <div class="wrap grid grid-2">
    <section class="card">
      <h3>ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
      <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
      <input id="reg_name" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø²ÙŠÙ†"/>
      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input id="reg_phone" type="tel" placeholder="05xxxxxxxx"/>
      <label>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
      <select id="reg_level">
        <option value="1AS">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
        <option value="2AS">Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
        <option value="3AS">Ø«Ø§Ù„Ø«Ø© Ø«Ø§Ù†ÙˆÙŠ</option>
      </select>
      <div class="row" style="margin-top:10px">
        <button class="btn" onclick="registerStudent()">ØªØ³Ø¬ÙŠÙ„</button>
        <span class="muted">Ù„Ù† ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø­ØªÙ‰ ÙŠØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</span>
      </div>
      <div class="note">ÙˆØ¹Ø¯ Ù†Ø¬Ø§Ø­: Ø³Ù†Ø³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ ÙÙ‡Ù… Ø§Ù„Ø¯Ø±ÙˆØ³ Ø¬ÙŠØ¯Ù‹Ø§ ÙˆØªØ­Ù‚ÙŠÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø¹Ø§Ù„ÙŠØ© ğŸ’ª</div>
    </section>

    <section class="card">
      <h3>ğŸ‘¤ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
      <label>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ</label>
      <input id="stu_login_phone" type="tel" placeholder="05xxxxxxxx"/>
      <div class="row" style="margin-top:10px">
        <button class="btn secondary" onclick="studentLogin()">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div id="student_view" class="hide" style="margin-top:12px">
        <div><b>Ø§Ù„Ø§Ø³Ù…:</b> <span id="sv_name"></span></div>
        <div><b>Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</b> <span id="sv_level" class="pill"></span></div>
        <div><b>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</b> <span id="sv_phone"></span></div>
        <div><b>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø§Ø±Ø©:</b> <span id="sv_sessions" class="pill"></span></div>
        <div id="sv_due" class="pill hide" style="background:#fff1f2;color:#b91c1c;margin-top:8px">ÙˆØµÙ„Øª 8 Ø­ØµØµ â€” ÙŠØ¬Ø¨ Ø§Ù„Ø¯ÙØ¹</div>
        <div style="margin-top:10px">
          <h4>ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø­ØµØµ Ù…Ø³ØªÙˆØ§Ùƒ</h4>
          <table>
            <thead><tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø³Ø§Ø¹Ø©</th></tr></thead>
            <tbody id="sv_table"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card">
      <h3>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (science)</label>
      <input id="adm_pass" type="password" placeholder="science"/>
      <div class="row" style="margin-top:10px">
        <button class="btn ok" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn flat" onclick="adminLogout()">Ø®Ø±ÙˆØ¬</button>
      </div>
      <div class="note">Ù†Ø³Ø®Ø© Ù…Ø­Ù„ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø®Ø§Ø¯Ù…Ø› ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙØ­ÙØ¸ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</div>
    </section>

    <section id="admin_panel" class="card hide" style="grid-column:1/-1">
      <div class="tabs">
        <div class="tab active" data-tab="students" onclick="switchTab(this)">Ø§Ù„Ø·Ù„Ø§Ø¨</div>
        <div class="tab" data-tab="schedules" onclick="switchTab(this)">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</div>
        <div class="tab" data-tab="settings" onclick="switchTab(this)">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      </div>

      <div class="kpi">
        <div class="card"><h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h4><div id="k_total" class="num">0</div></div>
        <div class="card"><h4>Ù…ÙØ¹Ù‘Ù„ÙˆÙ†</h4><div id="k_active" class="num">0</div></div>
        <div class="card"><h4>Ø¨Ù„ØºÙˆØ§ 8 Ø­ØµØµ</h4><div id="k_due" class="num">0</div></div>
      </div>

      <div id="tab_students">
        <div class="row search" style="margin-top:10px">
          <input id="search_q" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" oninput="renderStudents()"/>
          <select id="filter_level" onchange="renderStudents()">
            <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</option>
            <option value="1AS">Ø£ÙˆÙ„Ù‰</option>
            <option value="2AS">Ø«Ø§Ù†ÙŠØ©</option>
            <option value="3AS">Ø«Ø§Ù„Ø«Ø©</option>
          </select>
        </div>
        <table style="margin-top:10px">
          <thead>
            <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th><th>Ø§Ù„Ø­ØµØµ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
          </thead>
          <tbody id="students_tbody"></tbody>
        </table>
        <div class="row" style="margin-top:10px">
          <button class="btn warn" onclick="passSessionForLevel()">ØªÙ…Ø±ÙŠØ± Ø­ØµØ© Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
          <select id="pass_level">
            <option value="1AS">Ø£ÙˆÙ„Ù‰</option>
            <option value="2AS">Ø«Ø§Ù†ÙŠØ©</option>
            <option value="3AS">Ø«Ø§Ù„Ø«Ø©</option>
          </select>
          <button class="btn flat" onclick="resetLevelCounters()">ØªØµÙÙŠØ± Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
        </div>
      </div>

      <div id="tab_schedules" class="hide">
        <div class="row">
          <select id="sched_level" onchange="renderScheduleEditor()">
            <option value="1AS">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="2AS">Ø«Ø§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="3AS">Ø«Ø§Ù„Ø«Ø© Ø«Ø§Ù†ÙˆÙŠ</option>
          </select>
          <button class="btn flat" onclick="copySchedule()">Ù†Ø³Ø® Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø¢Ø®Ø±</button>
        </div>
        <table>
          <thead><tr><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø³Ø§Ø¹Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
          <tbody id="sched_tbody"></tbody>
        </table>
        <div class="row" style="margin-top:10px">
          <input id="new_day" placeholder="Ø§Ù„ÙŠÙˆÙ… (Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ø¨Øª)"/>
          <input id="new_time" placeholder="Ø§Ù„Ø³Ø§Ø¹Ø© (Ù…Ø«Ø§Ù„: 10:00 - 11:00)"/>
          <button class="btn" onclick="addSlot()">Ø¥Ø¶Ø§ÙØ© Ø­ØµØ©</button>
        </div>
      </div>

      <div id="tab_settings" class="hide">
        <label>Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ© (Ø¯.Ø¬)</label>
        <input id="price_input" type="number" min="0" step="50" placeholder="Ù…Ø«Ø§Ù„: 500"/>
        <div class="row" style="margin-top:10px">
          <button class="btn" onclick="saveSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          <button class="btn danger" onclick="hardReset()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ­Ø°ÙŠØ±)</button>
        </div>
        <div class="muted" style="margin-top:6px">ÙŠØ¸Ù‡Ø± ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¯ÙØ¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¥Ù„Ù‰ 8 Ø­ØµØµ.</div>
      </div>
    </section>
  </div>

  <script>
    const LS_KEY = "doroos_db_v2";
    const PASS = "science";
    const defaultDB = {
      price: 0,
      students: [],
      schedules:{
        "1AS":[["Ø§Ù„Ø³Ø¨Øª","10:00 - 11:00"],["Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","13:00 - 14:00"]],
        "2AS":[["Ø§Ù„Ø£Ø­Ø¯","11:00 - 12:00"],["Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","14:00 - 15:00"]],
        "3AS":[["Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†","09:00 - 10:00"],["Ø§Ù„Ø®Ù…ÙŠØ³","15:00 - 16:00"]]
      }
    };

    function loadDB(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw? JSON.parse(raw) : structuredClone(defaultDB);
      }catch(e){
        return structuredClone(defaultDB);
      }
    }
    function saveDB(){ localStorage.setItem(LS_KEY, JSON.stringify(DB)); }
    let DB = loadDB();

    const $ = (id)=>document.getElementById(id);
    function uuid(){ return "S"+Math.random().toString(36).slice(2,9); }
    function levelLabel(v){ return v==="1AS"?"Ø£ÙˆÙ„Ù‰":(v==="2AS"?"Ø«Ø§Ù†ÙŠØ©":"Ø«Ø§Ù„Ø«Ø©"); }

    function registerStudent(){
      const name = $("reg_name").value.trim();
      const phone = $("reg_phone").value.trim();
      const level = $("reg_level").value;
      if(!name || !phone){ alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"); return; }
      if(DB.students.find(s=>s.phone===phone)){ alert("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…ÙØ³Ø¬Ù„"); return; }
      DB.students.push({id:uuid(),name,phone,level,active:false,sessions:0});
      saveDB();
      $("reg_name").value=""; $("reg_phone").value="";
      alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ â€” Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙØ¹ÙŠÙ„");
      renderStudents(); refreshKPI();
    }

    function studentLogin(){
      const phone = $("stu_login_phone").value.trim();
      const s = DB.students.find(x=>x.phone===phone);
      if(!s){ alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ø§Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…"); return; }
      if(!s.active){ alert("Ù„Ù… ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ø¹Ø¯"); return; }
      $("sv_name").innerText = s.name;
      $("sv_phone").innerText = s.phone;
      $("sv_level").innerText = levelLabel(s.level);
      $("sv_sessions").innerText = s.sessions;
      if(s.sessions>=8){ $("sv_due").classList.remove("hide"); } else { $("sv_due").classList.add("hide"); }
      const tbody = $("sv_table"); tbody.innerHTML="";
      (DB.schedules[s.level]||[]).forEach(row=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td>`;
        tbody.appendChild(tr);
      });
      $("student_view").classList.remove("hide");
    }

    function adminLogin(){
      const p = $("adm_pass").value;
      if(p===PASS){ $("admin_panel").classList.remove("hide"); renderStudents(); renderScheduleEditor(); refreshKPI(); loadSettings(); }
      else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
    function adminLogout(){ $("admin_panel").classList.add("hide"); }

    function switchTab(el){
      document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
      el.classList.add("active");
      const tab = el.dataset.tab;
      $("tab_students").classList.toggle("hide", tab!=="students");
      $("tab_schedules").classList.toggle("hide", tab!=="schedules");
      $("tab_settings").classList.toggle("hide", tab!=="settings");
      if(tab==="students"){ renderStudents(); }
      if(tab==="schedules"){ renderScheduleEditor(); }
      if(tab==="settings"){ loadSettings(); }
    }

    function renderStudents(){
      const q = $("search_q")?$("search_q").value.trim().toLowerCase():"";
      const fl = $("filter_level")?$("filter_level").value:"";
      const tbody = $("students_tbody"); if(!tbody) return;
      tbody.innerHTML="";
      DB.students
        .filter(s=>!fl || s.level===fl)
        .filter(s=> !q || s.name.toLowerCase().includes(q) || s.phone.includes(q))
        .forEach(s=>{
          const tr = document.createElement("tr");
          const dueBadge = s.sessions>=8 ? `<span class="pill" style="background:#fff1f2;color:#b91c1c">8+</span>` : "";
          tr.innerHTML = `
            <td>${s.name}</td>
            <td>${s.phone}</td>
            <td>${levelLabel(s.level)}</td>
            <td>${s.sessions} ${dueBadge}</td>
            <td>${s.active? "Ù…ÙØ¹Ù‘Ù„" : "Ù…Ø¹Ù„Ù‘Ù‚"}</td>
            <td class="row" style="justify-content:center">
              <button class="btn ok" onclick="toggleActive('${s.id}')">${s.active?"Ø¥Ù„ØºØ§Ø¡":"ØªÙØ¹ÙŠÙ„"}</button>
              <button class="btn flat" onclick="editSessions('${s.id}')">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­ØµØµ</button>
              <button class="btn danger" onclick="deleteStudent('${s.id}')">Ø­Ø°Ù</button>
            </td>`;
          tbody.appendChild(tr);
        });
      refreshKPI();
    }
    function toggleActive(id){
      const s = DB.students.find(x=>x.id===id); if(!s) return;
      s.active = !s.active; saveDB(); renderStudents();
    }
    function editSessions(id){
      const s = DB.students.find(x=>x.id===id); if(!s) return;
      const v = prompt("Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ø¬Ø¯ÙŠØ¯:", s.sessions);
      if(v===null) return;
      const n = parseInt(v,10);
      if(!Number.isFinite(n) || n<0){ alert("Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©"); return; }
      s.sessions = n; saveDB(); renderStudents();
    }
    function deleteStudent(id){
      if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ")) return;
      DB.students = DB.students.filter(x=>x.id!==id); saveDB(); renderStudents();
    }
    function passSessionForLevel(){
      const level = $("pass_level").value;
      DB.students.forEach(s=>{ if(s.level===level && s.active) s.sessions++; });
      saveDB(); renderStudents();
      alert("ØªÙ… ØªÙ…Ø±ÙŠØ± Ø­ØµØ© Ù„Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø§Ø¨ "+levelLabel(level));
    }
    function resetLevelCounters(){
      const level = $("pass_level").value;
      if(!confirm("ØªØ£ÙƒÙŠØ¯ ØªØµÙÙŠØ± Ø¹Ø¯Ù‘Ø§Ø¯ "+levelLabel(level)+"ØŸ")) return;
      DB.students.forEach(s=>{ if(s.level===level) s.sessions=0; });
      saveDB(); renderStudents();
    }
    function refreshKPI(){
      const total = DB.students.length;
      const active = DB.students.filter(s=>s.active).length;
      const due = DB.students.filter(s=>s.sessions>=8).length;
      $("k_total").innerText = total;
      $("k_active").innerText = active;
      $("k_due").innerText = due;
    }

    function renderScheduleEditor(){
      const lvl = $("sched_level").value;
      const tbody = $("sched_tbody"); tbody.innerHTML="";
      (DB.schedules[lvl]||[]).forEach((row,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td>
          <td>
            <button class="btn flat" onclick="editSlot(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn danger" onclick="deleteSlot(${i})">Ø­Ø°Ù</button>
          </td>`;
        tbody.appendChild(tr);
      });
      saveDB();
    }
    function addSlot(){
      const lvl = $("sched_level").value;
      const d = $("new_day").value.trim();
      const t = $("new_time").value.trim();
      if(!d || !t){ alert("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ø³Ø§Ø¹Ø©"); return; }
      DB.schedules[lvl] = DB.schedules[lvl]||[];
      DB.schedules[lvl].push([d,t]); $("new_day").value=""; $("new_time").value="";
      renderScheduleEditor();
    }
    function deleteSlot(i){
      const lvl = $("sched_level").value;
      DB.schedules[lvl].splice(i,1);
      renderScheduleEditor();
    }
    function editSlot(i){
      const lvl = $("sched_level").value;
      const cur = DB.schedules[lvl][i];
      const nd = prompt("Ø§Ù„ÙŠÙˆÙ…:", cur[0]); if(nd===null) return;
      const nt = prompt("Ø§Ù„Ø³Ø§Ø¹Ø©:", cur[1]); if(nt===null) return;
      DB.schedules[lvl][i]=[nd.trim(),nt.trim()];
      renderScheduleEditor();
    }
    function copySchedule(){
      const from = $("sched_level").value;
      const to = prompt("Ø§Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø£ÙŠ Ù…Ø³ØªÙˆÙ‰ØŸ Ø§ÙƒØªØ¨ 1AS Ø£Ùˆ 2AS Ø£Ùˆ 3AS", from);
      if(!to || !["1AS","2AS","3AS"].includes(to)) { alert("Ù…Ø³ØªÙˆÙ‰ ØºÙŠØ± ØµØ­ÙŠØ­"); return; }
      DB.schedules[to] = JSON.parse(JSON.stringify(DB.schedules[from]||[]));
      alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ù† "+levelLabel(from)+" Ø¥Ù„Ù‰ "+levelLabel(to));
      saveDB();
    }

    function loadSettings(){ $("price_input").value = DB.price||0; }
    function saveSettings(){ DB.price = Number($("price_input").value||0); saveDB(); alert("ØªÙ… Ø§Ù„Ø­ÙØ¸"); }

    function hardReset(){
      if(!confirm("ØªØ­Ø°ÙŠØ±: Ø³ÙŠØ¤Ø¯ÙŠ Ù„Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!")) return;
      localStorage.removeItem(LS_KEY);
      DB = loadDB();
      renderStudents(); renderScheduleEditor(); refreshKPI();
      alert("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.");
    }
  </script>
</body>
</html>
